<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wetter Straubing</title>
  <link rel="stylesheet" href="https://necolas.github.io/normalize.css/latest/normalize.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #fff;
      color: #111;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 600;
    }
    h2 {
      font-size: 1rem;
      color: #555;
      margin-bottom: 1.5rem;
    }

    .search {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .search input {
      padding: 0.6rem 1rem;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 1rem;
    }
    .search button {
      padding: 0.6rem 1rem;
      background: #007aff;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    .forecast-scroll {
      display: flex;
      justify-content: center;
      overflow-x: auto;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .forecast-day {
      flex: 0 0 auto;
      background: #f4f5f7;
      border-radius: 14px;
      padding: 1rem;
      min-width: 80px;
      text-align: center;
      border: 2px solid transparent;
      transition: border 0.3s;
    }
    .forecast-day.active {
      border-color: #007aff;
    }
    .forecast-day span {
      display: block;
    }
    .emoji {
      font-size: 2.4rem;
      margin: 0.4rem 0;
    }

    .today-box {
      background: #246bff;
      color: white;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }
    .today-box .text {
      max-width: 60%;
    }
    .today-box .now {
      text-align: right;
    }
    .today-box .now .temp {
      font-size: 2.8rem;
      font-weight: bold;
    }
    .today-box .now .emoji {
      font-size: 3rem;
    }

    .periods {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .period {
      background: #f4f5f7;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      flex: 1;
      min-width: 100px;
    }
    .period .emoji {
      font-size: 2.2rem;
      margin-bottom: 0.3rem;
    }

    iframe {
      border: none;
      border-radius: 12px;
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
  <h1>Wetter Straubing, Bayern</h1>
  <h2>14 Tage Vorhersage und 21 Tage im Trend</h2>

  <div class="search">
    <input id="location-input" type="text" placeholder="Ort suchen...">
    <button id="search-btn">üîç</button>
  </div>

  <div class="forecast-scroll" id="forecast-days"></div>

  <div class="today-box">
    <div class="text">
      <h3>Heute</h3>
      <p id="summary">Wird geladen...</p>
    </div>
    <div class="now">
      <div class="emoji" id="emoji">‚òÄÔ∏è</div>
      <div class="temp" id="temp">--¬∞</div>
      <small>Jetzt <span id="current-time"></span> Uhr<br>f√ºhlt sich w√§rmer an</small>
    </div>
  </div>

  <div class="periods" id="hourly-periods"></div>

  <iframe id="radar" src="https://embed.windy.com/embed2.html?lat=48.88&lon=12.58&detailLat=48.88&detailLon=12.58&width=650&height=450&zoom=8&level=surface&overlay=rain&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1"></iframe>

  <script>
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    document.getElementById("current-time").textContent = `${hours}:${minutes}`;

    const weatherCodeToEmoji = (code, isNight = false) => {
      if (code === 0) return isNight ? "üåô" : "üåû";
      if ([1, 2, 3].includes(code)) return isNight ? "üåô‚òÅÔ∏è" : "üå§Ô∏è";
      if ([45, 48]) return "üå´Ô∏è";
      if ([51, 53, 55, 61, 63, 65, 80, 81, 82]) return "üåßÔ∏è";
      if ([71, 73, 75, 85, 86]) return "‚ùÑÔ∏è";
      if ([95, 96, 99]) return "‚õàÔ∏è";
      return "‚ùì";
    };

    async function fetchWeather(lat = 48.88, lon = 12.58, locationName = "Straubing, Bayern") {
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,weathercode&hourly=temperature_2m,weathercode&timezone=auto`);
      const data = await res.json();
      document.querySelector("h1").textContent = `Wetter ${locationName}`;

      const temp = data.current_weather.temperature.toFixed(1);
      document.getElementById("temp").textContent = `${temp}¬∞`;
      document.getElementById("emoji").textContent = weatherCodeToEmoji(data.current_weather.weathercode);
      document.getElementById("summary").innerHTML = `Aktuelle Temperatur: ${temp}¬∞<br><strong>Live-Daten von Open-Meteo</strong>`;

      const daily = data.daily;
      const days = document.getElementById("forecast-days");
      days.innerHTML = "";
      const wday = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
      for (let i = 0; i < 7; i++) {
        const d = new Date(daily.time[i]);
        const day = wday[d.getDay()];
        const el = document.createElement("div");
        el.className = `forecast-day${i === 0 ? " active" : ""}`;
        el.innerHTML = `<span>${i === 0 ? "Heute" : day}</span><span>${d.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })}</span><span class="emoji">${weatherCodeToEmoji(daily.weathercode[i])}</span><span>${Math.round(daily.temperature_2m_max[i])}¬∞</span>`;
        days.appendChild(el);
      }

      const hourly = data.hourly;
      const hoursDiv = document.getElementById("hourly-periods");
      hoursDiv.innerHTML = "";
      const entries = [
        { label: "Heute Nacht", index: 2 },
        { label: "Morgens", index: 6 },
        { label: "Vormittags", index: 9 },
        { label: "Nachmittags", index: 13 },
        { label: "Abends", index: 18 },
        { label: "Sp√§t nachts", index: 23 }
      ];
      for (const { label, index } of entries) {
        const isNight = label.toLowerCase().includes("nacht");
        const emoji = weatherCodeToEmoji(hourly.weathercode[index], isNight);
        const temp = Math.round(hourly.temperature_2m[index]);
        const div = document.createElement("div");
        div.className = "period";
        div.innerHTML = `<div class="emoji">${emoji}</div><strong>${temp}¬∞</strong><div>${label}</div>`;
        hoursDiv.appendChild(div);
      }
    }

    document.getElementById("search-btn").addEventListener("click", async () => {
      const input = document.getElementById("location-input").value.trim();
      if (!input) return;
      const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(input)}&count=1&language=de&format=json`);
      const data = await res.json();
      if (!data.results || data.results.length === 0) {
        alert("Ort nicht gefunden");
        return;
      }
      const { latitude, longitude, name, country } = data.results[0];
      document.getElementById("radar").src = `https://embed.windy.com/embed2.html?lat=${latitude}&lon=${longitude}&detailLat=${latitude}&detailLon=${longitude}&width=650&height=450&zoom=8&level=surface&overlay=rain&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1`;
      fetchWeather(latitude, longitude, `${name}, ${country}`);
    });

    fetchWeather();
  </script>
</body>
</html>
