<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Wetter – Komplett</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; font-family: sans-serif; background: #222; color: white; }
    .overlay { max-width: 750px; margin: 20px auto; padding: 25px; background: #333; border-radius: 12px; }
    .temp { font-size: 4rem; font-weight: bold; }
    .warning { background: #ffcc00; color: black; padding: 6px; border-radius: 6px; margin: 10px 0; display: inline-block; }
    .tabbar { display: flex; gap: 5px; margin-top: 10px; }
    .tabbar button { flex: 1; background: #444; color: white; border: none; padding: 10px; cursor: pointer; }
    .tabbar button.active { background: #666; font-weight: bold; }
    .hourly-scroll { display: flex; overflow-x: auto; gap: 8px; padding: 10px 0; }
    .hour, .day { flex: 0 0 auto; width: 70px; text-align: center; background: #555; border-radius: 8px; padding: 8px; }
    .hour.now { background: gold; color: black; font-weight: bold; }
    .day { width: 90px; }
    iframe { border: none; width: 100%; height: 400px; border-radius: 10px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="overlay">
    <h2 id="region">Wetter</h2>
    <div class="temp" id="temp">--°</div>
    <div class="warning" id="warn">Lade Wetter...</div>

    <div class="tabbar">
      <button id="tabHeute" class="active" onclick="zeige('heute')">Heute</button>
      <button id="tabMorgen" onclick="zeige('morgen')">Morgen</button>
    </div>

    <div class="hourly-scroll" id="stundenView"></div>
    <div class="hourly-scroll" id="tageView" style="display:none;"></div>

    <p id="beschreibung">...</p>
    <p style="text-align:right; font-size: 0.9em; opacity: 0.8;" id="zeit"></p>
    <iframe id="radar" src="https://www.wetter.com/maps-and-radar/radar/deutschland/DE0000000" loading="lazy"></iframe>
  </div>

  <script>
    const iconMap = {
      0: "☀️", 1: "🌤️", 2: "⛅", 3: "☁️", 45: "🌫️", 48: "🌫️",
      51: "🌦️", 61: "🌧️", 63: "🌧️", 65: "🌧️", 80: "🌧️",
      71: "❄️", 73: "❄️", 75: "❄️", 95: "🌩️", 99: "🌩️"
    };

    function beschreibung(code) {
      const txt = {
        0: "sonnig", 1: "meist sonnig", 2: "wolkig", 3: "bewölkt",
        45: "neblig", 48: "neblig", 51: "Nieselregen", 61: "leichter Regen",
        63: "mäßiger Regen", 65: "starker Regen", 80: "Regenschauer",
        71: "leichter Schneefall", 73: "Schnee", 75: "starker Schneefall",
        95: "Gewitter", 99: "schwere Gewitter"
      };
      return txt[code] || "-";
    }

    function zeige(welcher) {
      document.getElementById('tabHeute').classList.toggle('active', welcher === 'heute');
      document.getElementById('tabMorgen').classList.toggle('active', welcher === 'morgen');
      document.getElementById('stundenView').style.display = welcher === 'heute' ? 'flex' : 'none';
      document.getElementById('tageView').style.display = welcher === 'morgen' ? 'flex' : 'none';
    }

    async function ladeWetter(lat = 48.88, lon = 12.62) {
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation_probability,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`);
      const data = await res.json();

      const w = data.current_weather;
      document.getElementById("temp").innerText = `${w.temperature}°`;
      document.getElementById("zeit").innerText = new Date(w.time).toLocaleString("de-DE");
      document.getElementById("warn").innerText = `🌡️ aktuell: ${beschreibung(w.weathercode)}`;
      document.getElementById("beschreibung").innerText = `Die aktuelle Temperatur liegt bei ${w.temperature} °C mit etwa ${w.windspeed} km/h Wind.`;
      document.getElementById("region").innerText = "Wetter Straubing";

      // Stundenanzeige heute
      const now = new Date();
      const std = document.getElementById("stundenView");
      std.innerHTML = "";
      for (let i = 0; i < 24; i++) {
        const t = data.hourly.time[i].split("T")[1].slice(0,5);
        const stunde = parseInt(t);
        const isNow = stunde === now.getHours();
        std.innerHTML += `<div class='hour ${isNow ? "now" : ""}'>${t}<br>${iconMap[data.hourly.weathercode[i]] || "❔"}<br>${data.hourly.temperature_2m[i]}°<br>${data.hourly.precipitation_probability[i]}%</div>`;
      }
      setTimeout(() => {
        const active = document.querySelector(".hour.now");
        if (active) active.scrollIntoView({ behavior: 'smooth', inline: 'center' });
      }, 300);

      // Tagesanzeige
      const daily = document.getElementById("tageView");
      daily.innerHTML = "";
      for (let i = 0; i < 3; i++) {
        const d = new Date(data.daily.time[i]);
        daily.innerHTML += `<div class='day'>${d.toLocaleDateString("de-DE", { weekday: 'short' })}<br>${iconMap[data.daily.weathercode[i]] || "❔"}<br>${data.daily.temperature_2m_min[i]}–${data.daily.temperature_2m_max[i]}°</div>`;
      }
    }

    ladeWetter();
  </script>
</body>
</html>
